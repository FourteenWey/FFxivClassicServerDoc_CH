# 数据包头

FF14使用TCP协议与地图服务器和大厅服务器之间通信。命令被分成子模块，可以合并成一个基本数据分组，最大数据包大小为0xFFFF。

##基本数据包
这是所有子模块的容器。它可以包含很多要处理的子模块。他的每个基本数据包以0x10字节开头。下面是基本数据包的构成方式：
![](http://mydcs.f3322.net:11002/server/../Public/Uploads/2018-03-16/5aabe6972dc6c.png)

1. 认证 ： 99％的时间将为1，它仅在初次握手数据包时设置为0。
2. 是否 压缩/编码 ： 此字节的含义取决于客户端是否正在与大厅服务器或地图服务器进行通信。如果它是大厅服务器，则表明数据包当前使用Blowfish进行数据压缩。如果是映射服务器，则表示数据包使用zip进行数据压缩。服务器可以将它们设置为0并发送未加密/未压缩的数据包，并且让他们正确的被读取到。适合在开发或调试时使用。
3. 连接类型 ： 当客户端连接到地图服务器时，这些将被标记为0x1（Zone Connection）或0x2（Chat Connection）以定义套接字的连接类型。服务器响应后，它们将始终设置为0x0。未经大厅服务器测试。
4. 包长 ： 包含包头的数据包总长度。
5. 子模块数 ： 子模块中包含的数量。
6. 时间戳以毫秒为单位 ： Unix时间戳以毫秒为单位。

##子数据包
基础数据包可以包含多个子数据包。每个字数据包以0x10字节开头。
下面是基本数据包的构成方式：
![](http://mydcs.f3322.net:11002/server/../Public/Uploads/2018-03-16/5aabe94b58370.png)

1. 子数据包长：包含包头的子数据包总长度。
2. 类型：这个字段定义了这个子数据包的功能：
	0x0：初次握手
	0x2：区域服务器相关（未知）
	0x3：游戏包
	0x7：区域服务器相关（未知）
	0x8：区域服务器相关（未知）
3. 来源ID：触发子数据包的角色。
4. 目标ID：子数据包的角色。
5. 未知：仍然没有弄清楚这个字段的功能。

##游戏包
类型0x3子分组是大厅和地图服务器用来控制游戏的主要游戏数据包。它们在子数据包包头后也有自己的包头 ， 大小为0x10字节。
![](http://mydcs.f3322.net:11002/server/../Public/Uploads/2018-03-17/5aabeac289173.png)
1. 操作码 ： 定义该游戏包的操作码。检查页面操作码以获取操作码列表。
2. 时间戳 ： 以秒为单位的当前时间。这也用于设置游戏时间，并跟踪连接健康状况。